<section class="recommendations-section" data-section-id="{{ section.id }}" data-product-id="{{ product.id }}">
  <div class="section-container">
    {%- if section.settings.heading != blank -%}
      <h2 class="section-heading">{{ section.settings.heading }}</h2>
    {%- endif -%}

    <div class="product-grid" id="recommendations">
      {%- comment -%} Recommendations will be loaded dynamically {%- endcomment -%}
    </div>
  </div>
</section>

{% stylesheet %}
  .recommendations-section {
    padding: 4rem 0;
    background-color: var(--color-background);
  }

  .section-heading {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-foreground);
    margin-bottom: 3rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  #recommendations .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 2rem;
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    const productId = {{ product.id | json }};
    const recommendationsEl = document.getElementById('recommendations');

    if (recommendationsEl) {
      fetch(`/recommendations/products.json?product_id=${productId}&limit=4`)
        .then(response => response.json())
        .then(data => {
          if (data.products && data.products.length > 0) {
            const productsHTML = data.products.map(product => {
              const price = (product.price / 100).toFixed(2);
              const imageUrl = product.featured_image || '';
              return `
                <div class="product-card">
                  <a href="/products/${product.handle}" class="product-link">
                    ${imageUrl ? `<img src="${imageUrl}" alt="${product.title}" class="product-image">` : ''}
                    <h3 class="product-title">${product.title}</h3>
                    <p class="product-price">$${price}</p>
                  </a>
                </div>
              `;
            }).join('');
            recommendationsEl.innerHTML = productsHTML;
          } else {
            document.querySelector('.recommendations-section').style.display = 'none';
          }
        })
        .catch(error => {
          console.error('Error fetching recommendations:', error);
          document.querySelector('.recommendations-section').style.display = 'none';
        });
    }
  })();
{% endjavascript %}

{% schema %}
{
  "name": "Product Recommendations",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "You may also like"
    }
  ],
  "presets": [
    {
      "name": "Product Recommendations"
    }
  ]
}
{% endschema %}
